<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>å¹´çµ‚æŠ½çç³»çµ±ï½œç³»çµ±ç®¡ç†</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- âœ… Faviconï¼šæŠ½çéª°å­ -->
  <link rel="icon" type="image/svg+xml"
        href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='64' height='64'%3E%3Crect x='6' y='6' width='52' height='52' rx='12' fill='%230e0f14' stroke='%23f1d28a' stroke-width='4'/%3E%3Cg fill='%23f1d28a'%3E%3Ccircle cx='24' cy='24' r='4'/%3E%3Ccircle cx='40' cy='40' r='4'/%3E%3Ccircle cx='24' cy='40' r='4'/%3E%3Ccircle cx='40' cy='24' r='4'/%3E%3C/g%3E%3C/svg%3E" />

  <style>
    :root{
      --bg0:#07070a;
      --bg1:#0e0f14;
      --panel: rgba(255,255,255,.06);
      --panel2: rgba(255,255,255,.085);
      --text:#f6f3ea;
      --muted: rgba(246,243,234,.72);
      --gold:#d7b56d;
      --gold2:#f1d28a;
      --line: rgba(215,181,109,.22);
      --shadow: 0 18px 55px rgba(0,0,0,.55);
      --radius: 18px;
    }
    *{ box-sizing:border-box; }
    body{
      margin:0;
      color:var(--text);
      background:
        radial-gradient(900px 380px at 50% 0%, rgba(215,181,109,.22), transparent 65%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
      font-family: ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", "Noto Sans TC", "PingFang TC", "Microsoft JhengHei", sans-serif;
      overflow-x:hidden;
    }
    header{
      position:sticky; top:0; z-index:10;
      backdrop-filter: blur(10px);
      background: linear-gradient(180deg, rgba(0,0,0,.55), rgba(0,0,0,.25));
      border-bottom:1px solid var(--line);
    }
    .wrap{ max-width: 1200px; margin:0 auto; padding: 14px 18px; }
    .topbar{ display:flex; align-items:center; justify-content:space-between; gap:12px; }
    h1{ margin:0; font-size: 18px; font-weight: 900; letter-spacing:.6px; }
    .sub{ font-size: 12px; color: var(--muted); margin-top:2px; }
    .btn{
      appearance:none; border:1px solid rgba(215,181,109,.28);
      background: linear-gradient(180deg, rgba(215,181,109,.22), rgba(215,181,109,.10));
      color: var(--text);
      padding: 10px 14px;
      border-radius: 999px;
      cursor:pointer;
      font-weight:800;
      letter-spacing:.2px;
      box-shadow: 0 10px 30px rgba(0,0,0,.35);
      transition: transform .15s ease, filter .15s ease, border-color .15s ease;
      user-select:none;
      display:inline-flex; align-items:center; gap:8px;
    }
    .btn:hover{ transform: translateY(-1px); filter:brightness(1.08); border-color: rgba(241,210,138,.55); }
    .btn.secondary{
      background: rgba(255,255,255,.06);
      border-color: rgba(255,255,255,.14);
    }
    .btn.danger{
      background: linear-gradient(180deg, rgba(255,95,95,.18), rgba(255,95,95,.10));
      border-color: rgba(255,95,95,.35);
    }

    main{ padding: 16px 18px 26px; }
    .grid{
      max-width: 1200px;
      margin: 0 auto;
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 14px;
    }
    .card{
      background: linear-gradient(180deg, var(--panel2), var(--panel));
      border: 1px solid rgba(255,255,255,.10);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
      position:relative;
    }
    .card::after{
      content:"";
      position:absolute; inset:0;
      background: radial-gradient(800px 160px at 50% 0%, rgba(241,210,138,.15), transparent 60%);
      pointer-events:none;
      opacity:.75;
    }
    .inner{ position:relative; padding: 16px; }
    .chip{
      display:inline-flex;
      align-items:center; gap:8px;
      padding: 6px 10px;
      border-radius: 999px;
      border:1px solid rgba(215,181,109,.25);
      background: rgba(215,181,109,.12);
      color: rgba(241,210,138,.95);
      font-size: 12px;
      font-weight: 900;
    }
    h2{ margin:0 0 10px; font-size: 16px; display:flex; align-items:center; gap:10px; }
    label{ display:block; font-size:12px; color: var(--muted); margin: 10px 0 4px; }
    input[type="text"], input[type="number"], textarea{
      width:100%;
      background: rgba(0,0,0,.25);
      border:1px solid rgba(255,255,255,.16);
      color: var(--text);
      border-radius: 12px;
      padding: 10px 12px;
      min-height: 42px;
      font-size: 14px;
      outline:none;
    }
    textarea{ min-height: 140px; resize: vertical; }
    input[type="file"]{ margin-top: 6px; }
    .row{ display:flex; gap:10px; flex-wrap:wrap; }
    .row > *{ flex: 1; }
    .muted{ color: var(--muted); font-size: 12px; line-height: 1.45; }
    .divider{ border-top: 1px dashed rgba(255,255,255,.14); margin: 12px 0; }

    .list{
      margin-top: 10px;
      border: 1px solid rgba(255,255,255,.10);
      border-radius: 14px;
      overflow:hidden;
    }
    .item{
      padding: 10px 12px;
      border-bottom: 1px solid rgba(255,255,255,.08);
      display:flex; align-items:flex-start; justify-content:space-between; gap:10px;
      background: rgba(0,0,0,.12);
    }
    .item:last-child{ border-bottom:none; }
    .item .title{ font-weight: 900; }
    .item .desc{ margin-top:4px; color: var(--muted); font-size: 12px; }
    .miniBtns{ display:flex; gap:8px; flex-wrap:wrap; justify-content:flex-end; }
    .mini{ padding: 8px 10px; font-weight: 800; }

    .toggle{
      display:flex; align-items:center; gap:10px; flex-wrap:wrap;
      padding: 10px 12px;
      border: 1px solid rgba(255,255,255,.10);
      border-radius: 14px;
      background: rgba(0,0,0,.16);
      margin-top: 10px;
    }
    .toggle input{ transform: scale(1.2); }

    /* âœ… åå–®å…¬é–‹æª¢è¦–ï¼ˆæ˜­å…¬ä¿¡ï¼‰ */
    .namesPanel{
      margin-top: 10px;
      border: 1px solid rgba(255,255,255,.10);
      border-radius: 14px;
      overflow:hidden;
      background: rgba(0,0,0,.14);
      display:none;
    }
    .namesHead{
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      padding: 10px 12px;
      border-bottom: 1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.22);
      position:sticky; top:0;
    }
    .namesHead .t{
      font-weight: 900;
      letter-spacing:.2px;
      color: rgba(241,210,138,.95);
      font-size: 12px;
    }
    .namesBody{
      max-height: 320px;
      overflow:auto;
      padding: 10px 12px 12px;
    }
    .namesGrid{
      display:grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 6px 12px;
      font-size: 13px;
      line-height: 1.35;
    }
    .namesGrid .n{
      padding: 6px 8px;
      border-radius: 10px;
      border: 1px solid rgba(215,181,109,.16);
      background: rgba(255,255,255,.04);
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .badgeTiny{
      display:inline-flex; align-items:center; gap:6px;
      padding: 3px 8px;
      border-radius: 999px;
      font-size: 11px;
      border: 1px solid rgba(215,181,109,.22);
      background: rgba(215,181,109,.10);
      color: rgba(241,210,138,.95);
      font-weight: 900;
      white-space:nowrap;
    }

    @media (max-width: 980px){
      .grid{ grid-template-columns: 1fr; }
      .namesGrid{ grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
<header>
  <div class="wrap">
    <div class="topbar">
      <div>
        <h1>å¹´çµ‚æ„Ÿæ©é¤æœƒæŠ½çç³»çµ±</h1>
        <div class="sub">ç³»çµ±ç®¡ç†ï¼ˆæŠ½çå‰ç½®ä½œæ¥­ï¼šåå–®åŒ¯å…¥/ç®¡ç†ã€çé …è¨­å®šï¼‰</div>
      </div>
      <div class="row" style="justify-content:flex-end;">
        <button class="btn secondary" id="btnGoRaffle">è¿”å›æŠ½çä¸»ç•«é¢</button>
      </div>
    </div>
  </div>
</header>

<main>
  <div class="grid">
    <!-- Prizes -->
    <section class="card">
      <div class="inner">
        <h2><span class="chip">ğŸ çé …ç®¡ç†</span></h2>
        <div class="muted">å¯äº‹å…ˆå»ºç«‹ã€Œçé …åç¨± / çé …å…§å®¹ / çé …æ•¸é‡ã€ï¼ŒæŠ½çç¾å ´ç›´æ¥å¾ä¸‹æ‹‰å¼é¸å–®é¸æ“‡å³å¯ã€‚</div>

        <label>çé …åç¨±</label>
        <input type="text" id="prizeName" placeholder="ä¾‹å¦‚ï¼šè‘£äº‹é•·ç" />

        <label>çé …å…§å®¹</label>
        <input type="text" id="prizeContent" placeholder="ä¾‹å¦‚ï¼šç¾é‡‘ 1 è¬å…ƒ" />

        <label>çé …æ•¸é‡</label>
        <input type="number" id="prizeQty" min="1" value="1" />

        <div class="row" style="margin-top:10px;">
          <button class="btn" id="btnAddPrize">æ–°å¢/æ›´æ–°çé …</button>
          <button class="btn danger" id="btnClearPrizes">æ¸…ç©ºæ‰€æœ‰çé …</button>
        </div>

        <div class="divider"></div>
        <div class="muted">ç›®å‰çé …æ¸…å–®</div>
        <div class="list" id="prizeList"></div>
      </div>
    </section>

    <!-- Participants -->
    <section class="card">
      <div class="inner">
        <h2><span class="chip">ğŸ“‹ åå–®åŒ¯å…¥èˆ‡ç®¡ç†</span></h2>
        <div class="muted">æœ¬ç‰ˆæœ¬å·²ç§»é™¤ã€Œçµ„åˆ¥ã€èˆ‡ã€Œæ¬Šé‡ã€ï¼šæ¯è¡Œä¸€ä½åŒä»å§“åå³å¯ã€‚è‹¥è²¼ä¸Š CSVï¼Œä¹Ÿæœƒåªå–ç¬¬ä¸€æ¬„ï¼ˆå§“åï¼‰ã€‚</div>

        <label>1ï¸âƒ£ è²¼ä¸Šåå–®ï¼ˆæ¯è¡Œä¸€ä½ï¼‰</label>
        <textarea id="manualInput" placeholder="ç‹å°æ˜
æ—å°ç¾
å¼µå¤§å‰"></textarea>

        <div class="row" style="margin-top:10px;">
          <button class="btn" id="btnAddManual">åŠ å…¥/è¦†è“‹åå–®</button>
          <button class="btn danger" id="btnClearParticipants">æ¸…ç©ºåå–®</button>
        </div>

        <div class="divider"></div>

        <label>2ï¸âƒ£ æˆ–åŒ¯å…¥ CSV æª”ï¼ˆUTF-8ï¼Œå¯å«è¡¨é ­ï¼‰</label>
        <input type="file" id="fileInput" accept=".csv" />
        <div class="muted" style="margin-top:8px;">
          CSV è‹¥å«è¡¨é ­ï¼ˆå§“å/nameï¼‰æœƒè‡ªå‹•ç•¥éç¬¬ä¸€åˆ—ï¼›åƒ…å–ç¬¬ä¸€æ¬„ä½œç‚ºå§“åã€‚
        </div>

        <div class="divider"></div>

        <div class="toggle">
          <label style="margin:0; color:var(--text); font-weight:900;">
            <input type="checkbox" id="allowRepeat" />
            å…è¨±é‡è¤‡ä¸­çï¼ˆé è¨­ï¼šä¸å…è¨±ï¼‰
          </label>
          <button class="btn secondary mini" id="btnClearWon">æ¸…é™¤æ‰€æœ‰äººçš„ã€Œå·²ä¸­çã€ç‹€æ…‹</button>
        </div>

        <div class="divider"></div>

        <!-- âœ… 1) é€™è£¡åŠ ä¸Šï¼šå¯ä¸€æ¬¡é¡¯ç¤ºæ‰€æœ‰ã€Œç›®å‰æœ‰è³‡æ ¼åƒåŠ æŠ½çã€çš„åå–® -->
        <div class="row" style="margin-top:8px;">
          <button class="btn secondary" id="btnToggleEligible">é¡¯ç¤º/éš±è—ã€Œå¯æŠ½çåå–®ã€ï¼ˆæ˜­å…¬ä¿¡ï¼‰</button>
        </div>

        <div class="muted" id="stats" style="margin-top:10px;">ç›®å‰åå–®äººæ•¸ï¼š0</div>

        <div class="namesPanel" id="eligiblePanel">
          <div class="namesHead">
            <div class="t">å¯æŠ½çåå–®</div>
            <div class="badgeTiny" id="eligibleBadge">0 äºº</div>
          </div>
          <div class="namesBody">
            <div class="muted" id="eligibleHint" style="margin-bottom:10px;"></div>
            <div class="namesGrid" id="eligibleList"></div>
          </div>
        </div>

      </div>
    </section>
  </div>
</main>

<script>
/* ========= Storage Keys ========= */
const LS_PARTICIPANTS = 'raffle_participants_v2';
const LS_PRIZES = 'raffle_prizes_v2';
const LS_SETTINGS = 'raffle_settings_v2';

let participants = [];
let prizes = [];
let editingPrizeId = null;

/* ========= Helpers ========= */
function loadJSON(key, fallback){
  try{
    const raw = localStorage.getItem(key);
    if (!raw) return fallback;
    return JSON.parse(raw);
  }catch(e){ return fallback; }
}
function saveJSON(key,val){
  localStorage.setItem(key, JSON.stringify(val));
}
function escapeHTML(str) {
  return (str || '').replace(/[&<>"']/g, (c) => ({
    '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#39;'
  }[c]));
}
function normalizeName(name){
  return String(name||'').trim().replace(/\s+/g,' ');
}

/* ========= Load ========= */
function loadAll(){
  participants = loadJSON(LS_PARTICIPANTS, []);
  prizes = loadJSON(LS_PRIZES, []);
  const settings = loadJSON(LS_SETTINGS, {allowRepeat:false});
  document.getElementById('allowRepeat').checked = !!settings.allowRepeat;
}

/* ========= Navigation ========= */
document.getElementById('btnGoRaffle').addEventListener('click', () => {
  window.location.href = 'æŠ½çç¨‹å¼v2_æŠ½çä¸»ç•«é¢.html';
});

/* ========= Settings ========= */
document.getElementById('allowRepeat').addEventListener('change', (e) => {
  const settings = loadJSON(LS_SETTINGS, {allowRepeat:false});
  settings.allowRepeat = !!e.target.checked;
  saveJSON(LS_SETTINGS, settings);
  updateStats();
  renderEligibleList(); // âœ… å…è¨±é‡è¤‡åˆ‡æ›æ™‚ï¼Œè³‡æ ¼åå–®ä¹Ÿè·Ÿè‘—è®Š
});

/* ========= Prizes ========= */
const prizeNameEl = document.getElementById('prizeName');
const prizeContentEl = document.getElementById('prizeContent');
const prizeQtyEl = document.getElementById('prizeQty');
const prizeListEl = document.getElementById('prizeList');

/* ========= Participants ========= */
const statsEl = document.getElementById('stats');

/* ========= Eligible list (new) ========= */
const btnToggleEligible = document.getElementById('btnToggleEligible');
const eligiblePanel = document.getElementById('eligiblePanel');
const eligibleListEl = document.getElementById('eligibleList');
const eligibleBadge = document.getElementById('eligibleBadge');
const eligibleHint = document.getElementById('eligibleHint');

btnToggleEligible.addEventListener('click', () => {
  const show = eligiblePanel.style.display !== 'block';
  eligiblePanel.style.display = show ? 'block' : 'none';
  if (show) renderEligibleList();
});

/* ========= Init ========= */
loadAll();
renderPrizeList();
updateStats();
renderEligibleList();

/* ========= Prize actions ========= */
document.getElementById('btnAddPrize').addEventListener('click', () => {
  const name = normalizeName(prizeNameEl.value);
  const content = normalizeName(prizeContentEl.value);
  const qty = Math.max(1, Number(prizeQtyEl.value) || 1);

  if (!name || !content){
    alert('è«‹è¼¸å…¥ã€Œçé …åç¨±ã€èˆ‡ã€Œçé …å…§å®¹ã€ã€‚');
    return;
  }

  if (editingPrizeId){
    const idx = prizes.findIndex(p => p.id === editingPrizeId);
    if (idx >= 0){
      prizes[idx] = { id: editingPrizeId, name, content, qty };
    }
    editingPrizeId = null;
  }else{
    prizes.push({ id: crypto.randomUUID ? crypto.randomUUID() : String(Date.now()+Math.random()), name, content, qty });
  }

  saveJSON(LS_PRIZES, prizes);
  prizeNameEl.value = '';
  prizeContentEl.value = '';
  prizeQtyEl.value = 1;
  renderPrizeList();
});

document.getElementById('btnClearPrizes').addEventListener('click', () => {
  if (!confirm('ç¢ºå®šè¦æ¸…ç©ºæ‰€æœ‰çé …å—ï¼Ÿ')) return;
  prizes = [];
  editingPrizeId = null;
  saveJSON(LS_PRIZES, prizes);
  renderPrizeList();
});

function renderPrizeList(){
  prizeListEl.innerHTML = '';
  if (!prizes.length){
    prizeListEl.innerHTML = `<div class="item"><div class="desc">å°šæœªå»ºç«‹çé …ã€‚</div></div>`;
    return;
  }

  prizes.forEach(p => {
    const div = document.createElement('div');
    div.className = 'item';
    div.innerHTML = `
      <div>
        <div class="title">${escapeHTML(p.name)} <span style="color:rgba(241,210,138,.92)">ï¼ˆåé¡ ${escapeHTML(String(p.qty))}ï¼‰</span></div>
        <div class="desc">${escapeHTML(p.content)}</div>
      </div>
      <div class="miniBtns">
        <button class="btn secondary mini" data-act="edit" data-id="${escapeHTML(p.id)}">ç·¨è¼¯</button>
        <button class="btn danger mini" data-act="del" data-id="${escapeHTML(p.id)}">åˆªé™¤</button>
      </div>
    `;
    prizeListEl.appendChild(div);
  });

  prizeListEl.querySelectorAll('button[data-act]').forEach(btn => {
    btn.addEventListener('click', (e) => {
      const id = e.currentTarget.getAttribute('data-id');
      const act = e.currentTarget.getAttribute('data-act');
      if (act === 'edit'){
        const p = prizes.find(x => x.id === id);
        if (!p) return;
        editingPrizeId = id;
        prizeNameEl.value = p.name;
        prizeContentEl.value = p.content;
        prizeQtyEl.value = p.qty;
        window.scrollTo({top:0, behavior:'smooth'});
      }else if (act === 'del'){
        if (!confirm('ç¢ºå®šè¦åˆªé™¤æ­¤çé …å—ï¼Ÿ')) return;
        prizes = prizes.filter(x => x.id !== id);
        if (editingPrizeId === id) editingPrizeId = null;
        saveJSON(LS_PRIZES, prizes);
        renderPrizeList();
      }
    });
  });
}

/* ========= Participants import ========= */
document.getElementById('btnAddManual').addEventListener('click', () => {
  const text = document.getElementById('manualInput').value.trim();
  if (!text){
    alert('è«‹å…ˆè²¼ä¸Šåå–®å…§å®¹ã€‚');
    return;
  }
  const lines = text.split(/\r?\n/).map(x => x.trim()).filter(Boolean);

  const newList = [];
  const seen = new Set();
  let idCounter = 1;

  for (const line of lines){
    // allow "å§“å,..." pasted accidentally: only take first cell
    const name = normalizeName(line.split(',')[0]);
    if (!name) continue;
    if (seen.has(name)) continue;
    seen.add(name);
    newList.push({ id: idCounter++, name, hasWon:false });
  }

  if (!newList.length){
    alert('è§£æåå–®å¤±æ•—ã€‚è«‹ç¢ºèªæ¯è¡Œè‡³å°‘æœ‰ä¸€å€‹å§“åã€‚');
    return;
  }

  participants = newList;
  saveJSON(LS_PARTICIPANTS, participants);
  updateStats();
  renderEligibleList();
  alert('åå–®å·²æ›´æ–°ï¼Œå…± ' + participants.length + ' äººã€‚');
});

document.getElementById('btnClearParticipants').addEventListener('click', () => {
  if (!confirm('ç¢ºå®šè¦æ¸…ç©ºåå–®å—ï¼Ÿ')) return;

  participants = [];
  saveJSON(LS_PARTICIPANTS, participants);

  // âœ… æ¸…ç©ºç•«é¢ä¸Šè²¼ä¸Šçš„åå–®
  const manual = document.getElementById('manualInput');
  if (manual) manual.value = '';

  // âœ… é‡ç½®æª”æ¡ˆé¸æ“‡å™¨
  const file = document.getElementById('fileInput');
  if (file) file.value = '';

  updateStats();
  renderEligibleList();
  alert('åå–®å·²æ¸…ç©ºã€‚');
});

document.getElementById('btnClearWon').addEventListener('click', () => {
  if (!confirm('ç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰äººçš„ã€Œå·²ä¸­çã€ç‹€æ…‹å—ï¼Ÿ')) return;
  participants = participants.map(p => ({...p, hasWon:false}));
  saveJSON(LS_PARTICIPANTS, participants);
  updateStats();
  renderEligibleList();
});

document.getElementById('fileInput').addEventListener('change', (e) => {
  const file = e.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = (event) => importFromCSVText(event.target.result);
  reader.readAsText(file, 'utf-8');
});

function importFromCSVText(text){
  const lines = text.split(/\r?\n/).map(x => x.trim()).filter(Boolean);
  if (!lines.length){
    alert('CSV æª”æ¡ˆå…§å®¹ç‚ºç©ºã€‚');
    return;
  }

  // detect header in first line (only check first column)
  let startIndex = 0;
  const first = (lines[0].split(',')[0] || '').toLowerCase();
  if (first.includes('å§“å') || first.includes('name')) startIndex = 1;

  const newList = [];
  const seen = new Set();
  let idCounter = 1;

  for (let i=startIndex;i<lines.length;i++){
    const row = lines[i];
    const name = normalizeName((row.split(',')[0] || ''));
    if (!name) continue;
    if (seen.has(name)) continue;
    seen.add(name);
    newList.push({ id:idCounter++, name, hasWon:false });
  }

  if (!newList.length){
    alert('æœªè§£æå‡ºæœ‰æ•ˆåå–®ï¼Œè«‹ç¢ºèª CSV æ ¼å¼ã€‚');
    return;
  }

  participants = newList;
  saveJSON(LS_PARTICIPANTS, participants);
  updateStats();
  renderEligibleList();
  alert('CSV åå–®å·²è¼‰å…¥ï¼Œå…± ' + participants.length + ' äººã€‚');
}

/* ========= Stats + Eligible list ========= */
function updateStats(){
  const total = participants.length;
  const won = participants.filter(p => p.hasWon).length;

  const allowRepeat = !!loadJSON(LS_SETTINGS, {allowRepeat:false}).allowRepeat;
  const eligible = allowRepeat ? total : (total - won);

  statsEl.textContent = `ç›®å‰åå–®äººæ•¸ï¼š${total}ï¼ˆå·²ä¸­çï¼š${won}ï½œå¯æŠ½çï¼š${eligible}ï¼‰`;
}

function renderEligibleList(){
  // è‹¥é¢æ¿å°šæœªå±•é–‹ï¼Œä¹Ÿå…ˆæŠŠ badge/hint æ›´æ–°ï¼Œé¿å…è³‡è¨Šè½å·®
  const allowRepeat = !!loadJSON(LS_SETTINGS, {allowRepeat:false}).allowRepeat;

  const eligibleList = allowRepeat
    ? participants.slice()
    : participants.filter(p => !p.hasWon);

  eligibleBadge.textContent = `${eligibleList.length} äºº`;
  eligibleHint.textContent = allowRepeat
    ? 'ç›®å‰è¨­å®šï¼šå…è¨±é‡è¤‡ä¸­ç â†’ æ‰€æœ‰äººçš†ã€Œæœ‰è³‡æ ¼åƒåŠ æŠ½çã€ã€‚'
    : 'ç›®å‰è¨­å®šï¼šä¸å…è¨±é‡è¤‡ä¸­ç â†’ åƒ…é¡¯ç¤ºã€Œå°šæœªä¸­çã€è€…ï¼ˆå¯åƒåŠ æŠ½çï¼‰ã€‚';

  eligibleListEl.innerHTML = '';
  if (!eligibleList.length){
    eligibleListEl.innerHTML = `<div class="muted">ç›®å‰æ²’æœ‰å¯æŠ½çåå–®ï¼ˆå¯èƒ½å…¨éƒ¨éƒ½å·²ä¸­çï¼‰ã€‚</div>`;
    return;
  }

  // æ’åºï¼šç…§åŸå§‹åŒ¯å…¥é †åºï¼ˆè¼ƒç¬¦åˆæ˜­å…¬ä¿¡ï¼‰ï¼Œä¸åšäº‚åº
  eligibleList.forEach(p => {
    const d = document.createElement('div');
    d.className = 'n';
    d.textContent = p.name;
    eligibleListEl.appendChild(d);
  });
}
</script>
</body>
</html>
